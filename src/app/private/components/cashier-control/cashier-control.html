<div class="bg-green-200 min-h-screen w-full p-4 text-sm">
    <div class="flex flex-col justify-center items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-800">Control de Caja</h1>
    </div>
    <div
        class="flex flex-col sm:flex-row flex-wrap justify-center items-center gap-4 mb-4 w-full sm:w-auto px-4 sm:px-0">
        <button
            class="bg-white px-4 py-3 sm:py-2 rounded shadow hover:bg-gray-50 w-full sm:w-auto text-center font-medium active:scale-95 transition-transform disabled:opacity-50 disabled:cursor-not-allowed"
            [class.opacity-50]="isClosed()" [class.grayscale]="isClosed()" [disabled]="isClosed()"
            (click)="openNewSellModal()">Añadir nueva
            venta</button>
        <button
            class="bg-white px-4 py-3 sm:py-2 rounded shadow hover:bg-gray-50 w-full sm:w-auto text-center font-medium active:scale-95 transition-transform"
            (click)="openSellsHistoryModal()">Ver
            ventas</button>
        <button
            class="bg-white px-4 py-3 sm:py-2 rounded shadow hover:bg-gray-50 w-full sm:w-auto text-center font-medium active:scale-95 transition-transform disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-100 disabled:text-gray-500"
            [class.opacity-50]="isClosed()" [class.grayscale]="isClosed()" [disabled]="isClosed()"
            (click)="openCashClosingModal()">
            {{ isClosed() ? 'Caja Cerrada' : 'Cerrar caja' }}
        </button>
    </div>

    <!-- Sort Control -->
    <!-- Sort & Filter Control -->
    <div class="flex flex-col sm:flex-row justify-center items-center w-full mb-6 gap-4 animate-fade-in px-4">
        <!-- Sort Dropdown -->
        <div class="relative w-full sm:w-auto min-w-[200px]">
            <select (change)="sortOrder.set($any($event.target).value)"
                class="appearance-none w-full bg-white/80 backdrop-blur-sm border border-green-200/50 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-green-500/20 focus:border-green-500 block pl-4 pr-10 py-2.5 shadow-lg shadow-green-900/5 hover:bg-white hover:border-green-300 transition-all cursor-pointer outline-none font-medium text-center">
                <option value="date-desc">↓ Más recientes</option>
                <option value="date-asc">↑ Más antiguas</option>
                <option value="amount-desc">$$$ Mayor monto</option>
                <option value="amount-asc">$ Menor monto</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-green-600">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </div>

        <!-- Filter Type Dropdown -->
        <div class="relative w-full sm:w-auto min-w-[200px]">
            <select (change)="filterType.set($any($event.target).value)"
                class="appearance-none w-full bg-white/80 backdrop-blur-sm border border-green-200/50 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-green-500/20 focus:border-green-500 block pl-4 pr-10 py-2.5 shadow-lg shadow-green-900/5 hover:bg-white hover:border-green-300 transition-all cursor-pointer outline-none font-medium text-center">
                <option value="all">Todas</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
                <option value="Crédito">Crédito</option>
                <option value="Débito">Débito</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-green-600">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                </svg>
            </div>
        </div>
    </div>
    <div class="w-full overflow-x-auto">
        @if(sells().length === 0){ <div class="flex justify-center items-center w-full min-h-[200px] text-gray-800">
            Sin ventas para mostrar hoy
        </div>}
        @else {
        <!-- Desktop Table -->
        <div class="hidden md:block">
            <table class="w-full text-center border-separate border-spacing-y-4">
                <thead>
                    <tr>
                        <th class="w-1/4">Fecha</th>
                        <th class="w-1/4">Hora</th>
                        <th class="w-1/4">Tipo</th>
                        <th class="w-1/4">Monto</th>
                        <th class="w-1/4">Comentarios</th>
                        <th class="w-1/4">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @for (sell of sells(); track sell.id) {
                    <tr class="bg-white shadow-sm rounded-lg hover:shadow-md transition-shadow"
                        [class.opacity-50]="sell.isClosed" [class.grayscale]="sell.isClosed">
                        <td class="p-4 whitespace-nowrap">
                            {{ sell.date | date:'dd/MM' }}
                            @if(sell.history && sell.history.length > 0){<span class="text-orange-500 font-bold ml-1"
                                title="Venta editada">*</span>}
                        </td>
                        <td class="p-4 whitespace-nowrap">{{ sell.date | date:'HH:mm' }}</td>
                        <td class="p-4 whitespace-nowrap">{{ sell.type }}</td>
                        <td class="p-4 bg-green-100 rounded text-green-800 font-bold whitespace-nowrap">${{ sell.amount
                            }}
                        </td>
                        <td class="p-4 min-w-[200px]">@if(sell.comments){ {{ sell.comments }} }@else{-}</td>
                        <td class="p-4">
                            <button
                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                [disabled]="sell.isClosed" (click)="editSell(sell)">
                                Editar
                            </button>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile Cards -->
        <div class="md:hidden flex flex-col gap-3">
            @for (sell of sells(); track sell.id) {
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100" [class.opacity-50]="sell.isClosed"
                [class.grayscale]="sell.isClosed">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex flex-col">
                        <span class="font-semibold text-gray-800 text-lg">${{ sell.amount }}</span>
                        <div class="flex gap-1 text-xs text-gray-500">
                            <span>
                                {{ sell.date | date:'dd/MM' }}
                                @if(sell.history && sell.history.length > 0){<span class="text-orange-500 font-bold"
                                    title="Venta editada">*</span>}
                            </span>
                            <span>•</span>
                            <span>{{ sell.date | date:'HH:mm' }}</span>
                        </div>
                    </div>
                    <span class="bg-blue-50 text-blue-700 text-xs font-bold px-2 py-1 rounded-full uppercase">
                        {{ sell.type }}
                    </span>
                </div>
                @if(sell.comments) {
                <div class="mt-2 text-sm text-gray-600 bg-gray-50 p-2 rounded">
                    {{ sell.comments }}
                </div>
                }

                <div class="mt-3 flex justify-end">
                    <button
                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                        [disabled]="sell.isClosed" (click)="editSell(sell)">
                        Editar
                    </button>
                </div>
            </div>
            }
        </div>
        }
    </div>
</div>