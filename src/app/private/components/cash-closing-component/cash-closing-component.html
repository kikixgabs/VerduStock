<div animateLoad="zoomIn"
    class="bg-white w-full h-full md:w-auto md:h-auto md:max-w-4xl md:max-h-[90vh] md:rounded-lg p-4 md:p-6 text-sm flex flex-col gap-4 shadow-lg overflow-hidden">

    <div class="flex justify-between items-center border-b pb-4">
        <h1 class="text-2xl font-bold" [class.text-red-600]="isPastClosing()" [class.text-gray-800]="!isPastClosing()">
            {{ isPastClosing() ? '⚠️ Caja Pendiente' : 'Cerrar caja' }}
        </h1>
    </div>

    @if (isPastClosing()) {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-red-700 font-bold">
                    La caja del día anterior no fue cerrada.
                </p>
                <p class="text-sm text-red-600">
                    Desea cerrar la caja de ayer para poder abrir la del día de hoy? Revise los montos a continuación.
                </p>
            </div>
        </div>
    </div>
    } @else {
    <p class="text-gray-600">
        Revise la información de las ventas antes de proceder.
    </p>
    }

    <div class="overflow-x-auto max-h-[60vh] border rounded-lg">
        <table class="hidden md:table w-full divide-y divide-gray-200">
            <thead class="bg-gray-50 sticky top-0">
                <tr>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hora</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Comentarios</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @for(sell of sells(); track sell.id){
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-gray-700 font-medium">
                        {{ sell.date |date:'dd/MM HH:mm'}} @if(sell.history && sell.history.length > 0){<span
                            class="text-orange-500 font-bold ml-1" title="Venta editada">*</span>}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-green-600 font-semibold">
                        {{ sell.amount }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span
                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                            {{ sell.type }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-500 max-w-xs truncate" title="{{sell.comments}}">
                        {{ sell.comments || '-' }}
                    </td>
                    <td class="px-6 py-4">
                        <button
                            class="text-blue-600 hover:text-blue-800 font-medium text-xs border border-blue-600 hover:bg-blue-50 px-3 py-1 rounded transition-colors"
                            (click)="editSell(sell)">
                            Editar
                        </button>
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                        No hay ventas registradas para este cierre.
                    </td>
                </tr>
                }
            </tbody>
        </table>

        <div class="md:hidden flex flex-col gap-3 p-2">
            @for(sell of sells(); track sell.id){
            <div class="bg-white p-4 rounded shadow border border-gray-100">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-bold text-green-600 text-lg">${{ sell.amount }}</span>
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                        {{ sell.type }}
                    </span>
                </div>
                <div class="flex justify-between items-center text-xs text-gray-500 mb-2">
                    <span>
                        {{ sell.date | date:'dd/MM HH:mm' }}
                        @if(sell.history && sell.history.length > 0){<span class="text-orange-500 font-bold ml-1"
                            title="Venta editada">*</span>}
                    </span>
                </div>
                @if(sell.comments) {
                <div class="text-sm text-gray-600 bg-gray-50 p-2 rounded italic mb-2">
                    {{ sell.comments }}
                </div>
                }

                <div class="flex justify-end">
                    <button
                        class="text-blue-600 hover:text-blue-800 font-medium text-xs border border-blue-600 hover:bg-blue-50 px-3 py-1 rounded transition-colors"
                        (click)="editSell(sell)">
                        Editar
                    </button>
                </div>
            </div>
            } @empty {
            <div class="py-10 text-center text-gray-500 italic">
                No hay ventas registradas para este cierre.
            </div>
            }
        </div>
    </div>

    <div class="flex justify-end border-t pt-4">
        <div class="flex flex-col items-end">
            <span class="text-gray-600 text-sm">Total ingresado:</span>
            <span class="text-3xl font-bold text-green-600">${{ totalAmount() }}</span>
        </div>
    </div>

    <div class="flex sm:flex-row justify-end gap-3 pt-4 border-t mt-auto">
        <button
            class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 sm:py-2 px-6 rounded shadow transition-transform transform active:scale-95"
            (click)="cashClose()">
            {{ isPastClosing() ? 'Cerrar caja pendiente' : 'Cerrar caja' }}
        </button>
        <button
            class="w-full sm:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-3 sm:py-2 px-6 rounded shadow transition-transform transform active:scale-95"
            (click)="close()">
            Cancelar
        </button>
    </div>
</div>